var SCORE_FONT_SIZE=null;function RenderScore(){RenderBoard(this.app.canvas.add(0,0,1,.9),this.app);var t=this.app.canvas.add(0,.9,1,.1);t.dom.style.border="1px solid black",t.setColor("grey"),RenderToolbar(t,this.app)}function RenderBoard(t,e){for(var n=e.context.players.length,o=2==n?1:2,i=Math.ceil(n/o),r=1/o,d=1/i,a=0,s=0;s<i;s++)for(var c=0;c<o;c++){n%2==1&&a+1==n&&(r=1);var l=t.add(c*r,s*d,r,d);if(l.dom.style.border="1px solid black",l.setColor(e.context.players[a].color),RenderDisplay(a,l,e),n==++a)return}}function RenderDisplay(t,e,n){null==SCORE_FONT_SIZE&&(SCORE_FONT_SIZE=GetOptimalFontSize("XX",.25*e.width,e.height)),e.add(.25,0,.5,1,"div","DisplayScore"+t).dom.style.fontSize=SCORE_FONT_SIZE+"px";var o=e.add(0,0,.25,1,"button");o.setText("−",!1,SCORE_FONT_SIZE),o.dom.addEventListener("click",function(){ModifyScore(n.context.players,t,-1)}),o.dom.className="score_btn";var i=e.add(.75,0,.25,1,"button");i.setText("+",!1,SCORE_FONT_SIZE),i.dom.addEventListener("click",function(){ModifyScore(n.context.players,t,1)}),i.dom.className="score_btn",ModifyScore(n.context.players,t,n.context.players[t].score,!0)}function ModifyScore(t,e,n,o){o=DefaultArgument(o,!1);t[e].score=(o?0:parseInt(t[e].score))+n,GetDOM("DisplayScore"+e).innerHTML=t[e].score}function RenderToolbar(t,e){var n=t.add(0,0,1/3,1,"button","TBtnToDice"),o=GetOptimalFontSize("Nastavení",n.width,n.height);n.dom.style.fontSize=o+"px",n.setText("Kdo začne?"),n.dom.addEventListener("click",function(){e.toggleView("dice")});var i=t.add(1/3,0,1/3,1,"button");i.dom.style.fontSize=o+"px",i.setText("Nezdržuj"),i.dom.addEventListener("click",function(){e.toggleView("timer")});var r=t.add(2/3,0,1/3,1,"button","TBtnToSettings");r.dom.style.fontSize=o+"px",r.setText("Nastavení"),r.dom.addEventListener("click",function(){e.toggleView("settings")})}var MIN_PLAYERS=2,MAX_PLAYERS=6,COLORS=["red","lightgreen","lightblue","yellow","pink","orange","grey","white"];function RenderSettings(){var t=this.app.canvas.add(0,0,1,.9);t.setColor("lightgrey"),RenderSettingBoard(t,this.app);var e=this.app.canvas.add(0,.9,1,.1);e.dom.style.border="1px solid black",e.setColor("grey"),RenderSettingsToolbar(e,this.app)}function RenderSettingBoard(t,e){var n=1/11;t.dom.style.fontSize=GetOptimalFontSize("Počáteční skóre",t.width,t.height*n)+"px";var o=t.add(0,0,1,n);o.setText("Počet hráčů:",!1),o.setColor("#AAAAAA"),RenderFormPlayerCount(t.add(0,1*n,1,n),e);var i=t.add(0,2*n,1,n);i.setText("Počáteční skóre:",!1),i.setColor("#AAAAAA"),RenderFormInitScore(t.add(0,3*n,1,n),e);var r=t.add(0,4*n,1,n);r.setText("Barvy hráčů:",!1),r.setColor("#AAAAAA"),RenderFormColorWheel(t.add(0,5*n,1,6*n),e)}function RenderFormPlayerCount(t,e){for(var n=1/(MAX_PLAYERS-MIN_PLAYERS+1),o=MIN_PLAYERS;o<=MAX_PLAYERS;o++){var i=t.add((o-MIN_PLAYERS)*n,0,n,1),r="";o==e.context.numOfPlayers&&(r="checked"),i.dom.innerHTML='<input type="radio" name="FormPlayerCount" value="'+o+'" '+r+">"+o+"</radio>"}}function RenderFormInitScore(t,e){var n=.2,o=t.add(0,0,n,1,"button");o.dom.addEventListener("click",function(){ModifyInitScore(-5,e)}),o.dom.className="init_score_btn init_score_btn_left",o.setColor("darkred"),o.setText("-5",!0);var i=t.add(.2,0,n,1,"button");i.dom.addEventListener("click",function(){ModifyInitScore(-1,e)}),i.dom.className="init_score_btn init_score_btn_right",i.setColor("red"),i.setText("-1",!0),t.add(.4,0,n,1,"div","FormInitScoreDisplay").setText(e.context.initScore,!0);var r=t.add(3*n,0,n,1,"button");r.dom.addEventListener("click",function(){ModifyInitScore(1,e)}),r.dom.className="init_score_btn init_score_btn_left",r.setColor("lightgreen"),r.setText("1",!0);var d=t.add(.8,0,n,1,"button");d.dom.addEventListener("click",function(){ModifyInitScore(5,e)}),d.dom.className="init_score_btn init_score_btn_right",d.setColor("green"),d.setText("5",!0)}function ModifyInitScore(t,e){var n=GetDOM("FormInitScoreDisplay");e.context.initScore=parseInt(n.innerHTML)+t,n.innerHTML=e.context.initScore}function RenderFormColorWheel(t,e){for(var n=1/MAX_PLAYERS,o=1/COLORS.length,i=0;i<MAX_PLAYERS;i++){var r=t.add(0,i*n,1,n);r.dom.style.border="1px solid black";for(var d=0;d<COLORS.length;d++){var a=r.add(d*o,0,o,1);a.setColor(COLORS[d]);var s="";e.context.colorSetup[i]==d&&(s="checked"),a.dom.innerHTML='<input type="radio" name="FormPlayerColor'+i+'" value="'+d+'" '+s+">"}}}function RenderSettingsToolbar(t,e){var n=t.add(0,0,.5,1,"button");n.dom.addEventListener("click",function(){ApplySettings(e),e.toggleView("score")}),n.setText("Použít",!0);var o=t.add(.5,0,.5,1,"button");o.dom.addEventListener("click",function(){e.toggleView("score")}),o.setText("Zpět",!0)}function ApplySettings(t){for(var e=document.getElementsByName("FormPlayerCount"),n=0;n<e.length;n++)if(e[n].checked){t.context.numOfPlayers=e[n].value;break}for(var o=t.context;o.numOfPlayers<o.players.length;)o.players.pop();for(;o.numOfPlayers>o.players.length;)o.players.push(new Player);for(var i=0;i<o.players.length;i++){var r=document.getElementsByName("FormPlayerColor"+i);for(n=0;n<r.length;n++)if(r[n].checked){o.colorSetup[i]=n;break}o.players[i].color=COLORS[o.colorSetup[i]],o.players[i].score=o.initScore}}function RenderTimer(){var t=this.app.canvas.add(0,0,1,.9);t.setColor("lightgrey"),RenderTimerBoard(t,this.app);var e=this.app.canvas.add(0,.9,1,.1);e.dom.style.border="1px solid black",e.setColor("grey"),RenderTimerToolbar(e,this.app)}function RenderTimerBoard(t,e){e.context.countdown=e.context.initCountdown;var n=t.add(0,0,1,.1);n.setText("Odpočet",!0),n.setColor("#AAAAAA"),t.add(0,.1,1,.4,"div","CountdownDisplay").setText(IntToTime(e.context.initCountdown),!0),RenderTimerControls(t.add(0,.5,1,.1),e);t.add(0,.6,1,.1);var o=t.add(0,.7,1,.1);o.setText("Nastavení",!0),o.setColor("#AAAAAA"),RenderTimerSettings(t.add(0,.8,1,.2),e)}function RenderTimerToolbar(t,e){var n=t.add(0,0,.5,1,"button");n.dom.addEventListener("click",function(){CountdownControl(e,"stop")}),n.setText("Nastav",!0);var o=t.add(.5,0,.5,1,"button");o.dom.addEventListener("click",function(){e.toggleView("score")}),o.setText("Zpět",!0)}function IntToTime(t){var e=t%60;return Math.floor(t/60)+":"+e}function RenderTimerControls(t,e){var n=t.add(0,0,1/3,1,"button");n.dom.addEventListener("click",function(){CountdownControl(e,"play")}),n.setText("Spusť",!0);var o=t.add(1/3,0,1/3,1,"button");o.dom.addEventListener("click",function(){CountdownControl(e,"pause")}),o.setText("Pauza",!0);var i=t.add(2/3,0,1/3,1,"button");i.dom.addEventListener("click",function(){CountdownControl(e,"stop")}),i.setText("Reset",!0)}function RenderTimerSettings(t,e){var n=t.add(0,0,.2,1,"button");n.dom.addEventListener("click",function(){ModifyInitCountdown(e,-5)}),n.dom.className="init_score_btn init_score_btn_left",n.setColor("darkred"),n.setText("-5",!0);var o=t.add(.2,0,.2,1,"button");o.dom.addEventListener("click",function(){ModifyInitCountdown(e,-1)}),o.dom.className="init_score_btn init_score_btn_right",o.setColor("red"),o.setText("-1",!0),t.add(.4,0,.2,1,"div","InitCountdownDisplay").setText("XX:XX",!0);var i=t.add(.6,0,.2,1,"button");i.dom.addEventListener("click",function(){ModifyInitCountdown(e,1)}),i.dom.className="init_score_btn init_score_btn_left",i.setColor("lightgreen"),i.setText("+1",!0);var r=t.add(.8,0,.2,1,"button");r.dom.addEventListener("click",function(){ModifyInitCountdown(e,5)}),r.dom.className="init_score_btn init_score_btn_right",r.setColor("green"),r.setText("+5",!0),ModifyInitCountdown(e,0)}function CountdownControl(e,t){"play"==t?e.context.cntIntHndl=setInterval(function(){var t=GetDOM("CountdownDisplay");e.context.countdown--,t.innerHTML=IntToTime(e.context.countdown),0==e.context.countdown&&(clearInterval(e.context.cntIntHndl),t.innerHTML="KONEC!")},1e3):"pause"==t?clearInterval(e.context.cntIntHndl):"stop"==t?(clearInterval(e.context.cntIntHndl),e.context.countdown=e.context.initCountdown,GetDOM("CountdownDisplay").innerHTML=IntToTime(e.context.countdown)):LogError("Timer","CountdownControl","Invalid action name: "+t)}function ModifyInitCountdown(t,e){t.context.initCountdown=parseInt(t.context.initCountdown)+parseInt(e),GetDOM("InitCountdownDisplay").innerHTML=IntToTime(t.context.initCountdown)}var LOG_ERROR_LEVEL=1;function GetDOM(t){return document.getElementById(t)}function LogError(t,e,n){var o="ERROR: "+t+"::"+e+": "+n;console.error(o),0<LOG_ERROR_LEVEL&&alert(o)}function Random(t,e){return Math.floor(Math.random()*e+t)}function DefaultArgument(t,e){return void 0!==t?t:e}function GetOptimalFontSize(t,e,n,o){var i=DefaultArgument(o,100),r=GetDOM("HiddenResizer");r.style.fontSize=i+"px",r.innerHTML=t;for(var d=r.offsetWidth,a=r.offsetHeight;.8*e<d||.8*n<a;)i-=1,r.style.fontSize=i+"px",d=r.offsetWidth,a=r.offsetHeight;return i}function Element(){this.dom=null,this.width=0,this.height=0}function View(){this.app=null}function App(){this.context={},this.canvas=new Element,this.views={},this.currentView=""}Element.prototype.add=function(t,e,n,o,i,r){i=DefaultArgument(i,"div"),r=DefaultArgument(r,null);var d=new Element,a=document.createElement(i);return null!=r&&a.setAttribute("id",r),this.dom.appendChild(a),d.dom=a,d.width=this.width*n,d.height=this.height*o,d.dom.style.position="absolute",d.dom.style.left=this.width*t+"px",d.dom.style.top=this.height*e+"px",d.dom.style.width=d.width+"px",d.dom.style.height=d.height+"px",d},Element.prototype.setColor=function(t){this.dom.style.background=t},Element.prototype.setText=function(t,e,n){var o=null;(e=DefaultArgument(e,!1))?(n=DefaultArgument(n,100),o=GetOptimalFontSize(t,this.width,this.height,n)):"undefined"!==n&&(o=n);var i=document.createTextNode(t);null!=o&&(this.dom.style.fontSize=o+"px"),this.dom.appendChild(i)},View.prototype.render=function(){LogError("View","render","This method is not implemented!")},View.prototype.bootstrap=function(t){this.app=t},App.prototype.addView=function(t,e){return this.views.hasOwnProperty(e)?(LogError("App","addView","View with name "+e+" already exists!"),!1):(this.views[e]=t,this.views[e].bootstrap(this),!0)},App.prototype.toggleView=function(t){this.views.hasOwnProperty(t)?(this.currentView=t,this.render()):LogError("App","toggleView","View called "+t+" does not exist!")},App.prototype.render=function(){this.canvas.dom.innerHTML="",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.dom.style.position="absolute",this.canvas.dom.style.width=this.canvas.width+"px",this.canvas.dom.style.height=this.canvas.height+"px",this.views[this.currentView].render()},App.prototype.bootstrap=function(t){this.canvas.dom=GetDOM(t);var e=this;window.addEventListener("resize",function(){e.render()})};var DICE_FONT_SIZE=null;function RenderDice(){var t=this.app.canvas.add(0,0,1,.1);t.setText("Kdo začne?",!0),t.setColor("#AAAAAA");var e=this.app.canvas.add(0,.1,1,.8,"div","ThrowResultBoard");e.setColor("lightgrey");var n=GetOptimalFontSize("#######",e.width,e.height,1e3);e.dom.style.fontSize=n+"px",e.setText("??");var o=this.app.canvas.add(0,.9,1,.1);o.setColor("grey"),o.dom.style.border="1px solid black",RenderToolbarDice(o,this.app)}function RenderToolbarDice(t,e){var n=t.add(0,0,1/3,1,"button"),o=GetOptimalFontSize("Hoď kostkami",n.width,n.height);n.dom.addEventListener("click",function(){ThrowDice(e)}),n.dom.style.fontSize=o+"px",n.setText("Hoď kostkami");var i=t.add(1/3,0,1/3,1,"button");i.dom.addEventListener("click",function(){TossCoin(e)}),i.dom.style.fontSize=o+"px",i.setText("Hoď mincí");var r=t.add(2/3,0,1/3,1,"button");r.dom.addEventListener("click",function(){e.toggleView("score")}),r.dom.style.fontSize=o+"px",r.setText("Zpět")}function ThrowDice(t){var e=["⚀","⚁","⚂","⚃","⚄","⚅"],n=Random(1,6)-1,o=Random(1,6)-1,i=Random(1,6)-1;GetDOM("ThrowResultBoard").innerHTML=e[n]+" "+e[o]+" "+e[i]}function TossCoin(t){GetDOM("ThrowResultBoard").innerHTML=["hlava","orel"][Random(1,2)-1]}