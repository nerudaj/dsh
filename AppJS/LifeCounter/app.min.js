"use strict";var LOG_ERROR_LEVEL=1;function GetDOM(e){return document.getElementById(e)}function LogError(e,t,n){var o="ERROR: "+e+"::"+t+": "+n;console.error(o),0<LOG_ERROR_LEVEL&&alert(o)}function Random(e,t){return Math.floor(Math.random()*t+e)}function DefaultArgument(e,t){return void 0!==e?e:t}function GetOptimalFontSize(e,t,n,o){var r=DefaultArgument(o,100),i=GetDOM("HiddenResizer");i.style.fontSize=r+"px",i.innerHTML=e;for(var a=i.offsetWidth,d=i.offsetHeight;t<a||n<d;)r-=1,i.style.fontSize=r+"px",a=i.offsetWidth,d=i.offsetHeight;return r}function Element(){this.dom=null,this.width=0,this.height=0}function View(){this.app=null}function App(){this.context={},this.canvas=new Element,this.views={},this.currentView=""}Element.prototype.add=function(e,t,n,o,r,i){r=DefaultArgument(r,"div"),i=DefaultArgument(i,null);var a=new Element,d=document.createElement(r);return null!=i&&d.setAttribute("id",i),this.dom.appendChild(d),a.dom=d,a.width=this.width*n,a.height=this.height*o,a.dom.style.position="absolute",a.dom.style.left=this.width*e+"px",a.dom.style.top=this.height*t+"px",a.dom.style.width=a.width+"px",a.dom.style.height=a.height+"px",a},Element.prototype.setColor=function(e){this.dom.style.background=e},Element.prototype.setText=function(e,t,n){var o=null;(t=DefaultArgument(t,!1))?GetOptimalFontSize(e,this.width,this.height,n):"undefined"!==n&&(o=n);var r=document.createTextNode(e);null!=o&&(this.dom.style.fontSize=o+"px"),this.dom.appendChild(r)},View.prototype.render=function(){LogError("View","render","This method is not implemented!")},View.prototype.bootstrap=function(e){this.app=e},App.prototype.addView=function(e,t){return this.views.hasOwnProperty(t)?(LogError("App","addView","View with name "+t+" already exists!"),!1):(this.views[t]=e,this.views[t].bootstrap(this),!0)},App.prototype.toggleView=function(e){this.views.hasOwnProperty(e)?(this.currentView=e,this.render()):LogError("App","toggleView","View called "+e+" does not exist!")},App.prototype.render=function(){this.canvas.dom.innerHTML="",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.dom.style.position="absolute",this.canvas.dom.style.width=this.canvas.width+"px",this.canvas.dom.style.height=this.canvas.height+"px",this.views[this.currentView].render()},App.prototype.bootstrap=function(e){this.canvas.dom=GetDOM(e);var t=this;window.addEventListener("resize",function(){t.render()})};var DICE_FONT_SIZE=null;function RenderDice(){RenderDiceRows(this.app.canvas.add(0,0,1,.9),this.app);var e=this.app.canvas.add(0,.9,1,.1);e.setColor("grey"),RenderToolbarDice(e,this.app)}function RenderDiceRows(e,t){var n=1/t.context.players.length;DICE_FONT_SIZE=GetOptimalFontSize("Hráč X hodil: XX",e.width,e.height*n);for(var o=0;o<t.context.players.length;o++){var r=e.add(0,o*n,1,n,"div","DiceRow"+o);r.dom.style.fontSize=DICE_FONT_SIZE+"px",r.setText("Hráč "+(o+1)+" hodil: ??",!1,DICE_FONT_SIZE),r.setColor(t.context.players[o].color)}}function RenderToolbarDice(e,t){var n=e.add(0,0,.5,1,"button");n.dom.addEventListener("click",function(){ThrowDice(t)}),n.setText("Hoď kostkami",!0);var o=e.add(.5,0,.5,1,"button");o.dom.addEventListener("click",function(){t.toggleView("score")}),o.setText("Zpět",!0)}function ThrowDice(e){for(var t=0;t<e.context.players.length;t++){var n=GetDOM("DiceRow"+t),o=Random(1,20);n.innerHTML="Hráč "+(t+1)+" hodil: "+o}}var SCORE_FONT_SIZE=null;function RenderScore(){RenderBoard(this.app.canvas.add(0,0,1,.9),this.app);var e=this.app.canvas.add(0,.9,1,.1);e.setColor("grey"),RenderToolbar(e,this.app)}function RenderBoard(e,t){for(var n=t.context.players.length,o=2==n?1:2,r=Math.ceil(n/o),i=1/o,a=1/r,d=0,s=0;s<r;s++)for(var l=0;l<o;l++){n%2==1&&d+1==n&&(i=1);var c=e.add(l*i,s*a,i,a);if(c.setColor(t.context.players[d].color),RenderDisplay(d,c,t),n==++d)return}}function RenderDisplay(e,t,n){null==SCORE_FONT_SIZE&&(SCORE_FONT_SIZE=GetOptimalFontSize("000",t.width*.5,t.height)),t.add(.25,0,.5,1,"div","DisplayScore"+e).dom.style.fontSize=SCORE_FONT_SIZE+"px";var o=t.add(0,0,.25,1,"button");o.setText("−",!1,SCORE_FONT_SIZE),o.dom.addEventListener("click",function(){ModifyScore(n.context.players,e,-1)}),o.dom.className="score_btn";var r=t.add(.75,0,.25,1,"button");r.setText("+",!1,SCORE_FONT_SIZE),r.dom.addEventListener("click",function(){ModifyScore(n.context.players,e,1)}),r.dom.className="score_btn",ModifyScore(n.context.players,e,n.context.players[e].score,!0)}function ModifyScore(e,t,n,o){o=DefaultArgument(o,!1);e[t].score=(o?0:parseInt(e[t].score))+n,GetDOM("DisplayScore"+t).innerHTML=e[t].score}function RenderToolbar(e,t){var n=e.add(0,0,.5,1,"button","TBtnToDice");n.setText("Kdo začne?",!0),n.dom.addEventListener("click",function(){t.toggleView("dice")});var o=e.add(.5,0,.5,1,"button","TBtnToSettings");o.setText("Nastavení",!0),o.dom.addEventListener("click",function(){t.toggleView("settings")})}var MIN_PLAYERS=2,MAX_PLAYERS=6,COLORS=["red","lightgreen","lightblue","yellow","pink","orange","grey","white"];function RenderSettings(){var e=this.app.canvas.add(0,0,1,.9);e.setColor("lightgrey"),RenderSettingBoard(e,this.app);var t=this.app.canvas.add(0,.9,1,.1);t.setColor("grey"),RenderSettingsToolbar(t,this.app)}function RenderSettingBoard(e,t){var n=1/11;e.dom.style.fontSize=GetOptimalFontSize("Počáteční skóre",e.width,e.height*n)+"px",e.add(0,0,1,n).setText("Počet hráčů:",!1),RenderFormPlayerCount(e.add(0,1*n,1,n),t),e.add(0,2*n,1,n).setText("Počáteční skóre:",!1),RenderFormInitScore(e.add(0,3*n,1,n),t),e.add(0,4*n,1,n).setText("Barvy hráčů:",!1),RenderFormColorWheel(e.add(0,5*n,1,6*n),t)}function RenderFormPlayerCount(e,t){for(var n=1/(MAX_PLAYERS-MIN_PLAYERS+1),o=MIN_PLAYERS;o<=MAX_PLAYERS;o++){var r=e.add((o-MIN_PLAYERS)*n,0,n,1),i="";o==t.context.numOfPlayers&&(i="checked"),r.dom.innerHTML='<input type="radio" name="FormPlayerCount" value="'+o+'" '+i+">"+o+"</radio>"}}function RenderFormInitScore(e,t){var n=e.add(0,0,.2,1,"button");n.dom.addEventListener("click",function(){ModifyInitScore(-5,t)}),n.setColor("darkred"),n.setText("-5");var o=e.add(.2,0,.2,1,"button");o.dom.addEventListener("click",function(){ModifyInitScore(-1,t)}),o.setColor("red"),o.setText("-1"),e.add(.4,0,.2,1,"div","FormInitScoreDisplay").setText(t.context.initScore);var r=e.add(3*.2,0,.2,1,"button");r.dom.addEventListener("click",function(){ModifyInitScore(1,t)}),r.setColor("lightgreen"),r.setText("1");var i=e.add(.8,0,.2,1,"button");i.dom.addEventListener("click",function(){ModifyInitScore(5,t)}),i.setColor("green"),i.setText("5")}function ModifyInitScore(e,t){var n=GetDOM("FormInitScoreDisplay");t.context.initScore=parseInt(n.innerHTML)+e,n.innerHTML=t.context.initScore}function RenderFormColorWheel(e,t){for(var n=1/MAX_PLAYERS,o=1/COLORS.length,r=0;r<MAX_PLAYERS;r++)for(var i=e.add(0,r*n,1,n),a=0;a<COLORS.length;a++){var d=i.add(a*o,0,o,1);d.setColor(COLORS[a]);var s="";t.context.colorSetup[r]==a&&(s="checked"),d.dom.innerHTML='<input type="radio" name="FormPlayerColor'+r+'" value="'+a+'" '+s+">"}}function RenderSettingsToolbar(e,t){var n=e.add(0,0,.5,1,"button");n.dom.addEventListener("click",function(){ApplySettings(t),t.toggleView("score")}),n.setText("Použít",!0);var o=e.add(.5,0,.5,1,"button");o.dom.addEventListener("click",function(){t.toggleView("score")}),o.setText("Zpět",!0)}function ApplySettings(e){for(var t=document.getElementsByName("FormPlayerCount"),n=0;n<t.length;n++)if(t[n].checked){e.context.numOfPlayers=t[n].value;break}for(var o=e.context;o.numOfPlayers<o.players.length;)o.players.pop();for(;o.numOfPlayers>o.players.length;)o.players.push(new Player);for(var r=0;r<o.players.length;r++){var i=document.getElementsByName("FormPlayerColor"+r);for(n=0;n<i.length;n++)if(i[n].checked){o.colorSetup[r]=n;break}o.players[r].color=COLORS[o.colorSetup[r]],o.players[r].score=o.initScore}}